#!/usr/bin/env python
# @PYFAUST_LICENSE_HEADER@

from setuptools import setup, Extension
#from distutils.core import setup, Extension
from Cython.Build import cythonize
import numpy
import sys

version = '@CPACK_PACKAGE_VERSION@'

if(version == ''):
    version = '0.0.0' # typically when compiling just for testing
                    # (not for packaging with a proper version)
                    # it avoids error PEP440

if sys.platform == 'win32':
    from os import sep
    from glob import glob

    PyFaust = Extension('_FaustCorePy',
                        sources = @PY_EXT_SOURCES@,
                        language = 'c++',
                        include_dirs=[@FAUST_PYTHON_INCLUDE_DIR@, numpy.get_include()],
                        library_dirs=[@FAUST_PYTHON_LIB_DIR@],
                        libraries=[ @FAUST_PYTHON_LIBS@],
                        extra_compile_args = [ "/w", "/EHsc" , "/openmp"],
                        #extra_link_args = [ "-s" ],
                        extra_objects = @PYTHON_EXT_EXTRA_OBJECTS@
                       )


else: # linux and mac
    PyFaust = Extension('_FaustCorePy',
                        sources = @PY_EXT_SOURCES@,
                        language = 'c++',
                        include_dirs=[@FAUST_PYTHON_INCLUDE_DIR@, numpy.get_include()],
                        library_dirs=[@FAUST_PYTHON_LIB_DIR@],
                        libraries=[@FAUST_PYTHON_LIBS@],
                        extra_compile_args = [ "-std=c++11", "-O2", "-fopenmp"],
                        extra_link_args = [ "-s" , "-fopenmp"],
                        extra_objects = @PYTHON_EXT_EXTRA_OBJECTS@
                       )



setup(
    name = 'pyfaust',
    version = version, # cf. header
    ext_modules = cythonize(PyFaust, compiler_directives={'language_level': sys.version_info.major }),
    packages = [ 'pyfaust' ],
    url = 'http://faust.inria.fr',
    description = 'TODO',
    long_description = 'TODO',
    classifiers = [ 'TODO' ],
    install_requires = [ 'pygsp', 'scipy', 'numpy', 'matplotlib>=2.0.0' ], #ENOTE: order matters (last pkg installed first)
    license = "INRIA",
    package_data = {
        'pyfaust': [ 'data/*.mat', 'license*.txt' ]
    }
)
